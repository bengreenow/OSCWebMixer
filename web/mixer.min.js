var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};
var channelsDiv=document.getElementById("channels"),auxSelect=document.getElementById("aux"),panCheckbox=document.getElementById("panning"),favourites=document.getElementById("favourites"),auxiliaries=document.getElementById("auxiliaries"),ws=null,timeout=null;
function sliderChange(a){a=parseFloat(this.value);this.parentNode.style.setProperty("--value",100*a+"%");if(ws){var c={aux:parseInt(auxSelect.options[auxSelect.selectedIndex].dataset.channel),channel:parseInt(this.dataset.channel)},b="level";this.classList.contains("panInput")&&(b="pan");c[b]=a;ws.send(JSON.stringify(c))}}function requestValues(){ws.send(JSON.stringify({"aux?":auxSelect.options[auxSelect.selectedIndex].dataset.channel}))}
function onMessage(a){a=JSON.parse(a.data);if(a.config)buildAux(a.config.aux),buildChannels(a.config.channels);else if(a["aux?"]&&a["aux?"]==auxSelect.options[auxSelect.selectedIndex].dataset.channel){for(var c=$jscomp.makeIterator(document.getElementsByClassName("volumeInput")),b=c.next();!b.done;b=c.next())b=b.value,b.value=a.channels[b.dataset.channel].level,b.parentNode.style.setProperty("--value",100*b.value+"%");c=$jscomp.makeIterator(document.getElementsByClassName("panInput"));for(b=c.next();!b.done;b=
c.next())b=b.value,b.value=a.channels[b.dataset.channel].pan,b.parentNode.style.setProperty("--value",100*b.value+"%");a=(a=localStorage.getItem("aux"+auxSelect.value+"fav"))?a.split(","):[];favourites.checked="true"==localStorage.getItem("aux"+auxSelect.value+"favChecked");b=$jscomp.makeIterator(document.querySelectorAll('input[name="fav[]"]'));for(c=b.next();!c.done;c=b.next())c=c.value,c.checked=-1!=a.indexOf(c.value);favourites.dispatchEvent(new Event("change"))}else{if(void 0!=a.name)for(c=$jscomp.makeIterator(document.querySelectorAll('input[data-channel="'+
a.channel+'"]')),b=c.next();!b.done;b=c.next())b.value.previousElementSibling.innerHTML=a.name;if(void 0!=a.auxname){b=$jscomp.makeIterator(auxSelect.options);for(c=b.next();!c.done;c=b.next())c=c.value,c.value==a.channel&&(c.innerHTML=a.auxname,auxSelect.previousElementSibling.innerHTML=auxSelect.getElementsByTagName("option")[auxSelect.selectedIndex].text);b=$jscomp.makeIterator(auxiliaries.getElementsByTagName("button"));for(c=b.next();!c.done;c=b.next())if(c=c.value,c.value==a.channel){c.innerText=
a.auxname;return}}if(a.aux==auxSelect.options[auxSelect.selectedIndex].dataset.channel)if(void 0!=a.level)for(c=$jscomp.makeIterator(document.querySelectorAll('input[data-channel="'+a.channel+'"].volumeInput')),b=c.next();!b.done;b=c.next())b=b.value,b.value=a.level,b.parentNode.style.setProperty("--value",100*b.value+"%");else if(void 0!=a.pan)for(c=$jscomp.makeIterator(document.querySelectorAll('input[data-channel="'+a.channel+'"].panInput')),b=c.next();!b.done;b=c.next())b=b.value,b.value=a.pan,
b.parentNode.style.setProperty("--value",100*b.value+"%")}}
function buildAux(a){var c="";auxiliaries.innerHTML="";a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;c+='<option value="'+b.channel+'" data-channel="'+b.channel+'" data-colour="'+b.colour+'" data-stereo="'+b.stereo+'">'+b.label+"</option>";var d=document.createElement("button");d.value=b.channel;d.innerHTML=b.label;d.style.setProperty("--tint",b.colour);auxiliaries.appendChild(d)}auxSelect.innerHTML=c;localStorage.getItem("aux")?auxSelect.value=localStorage.getItem("aux"):
document.body.classList.add("auxPicker");auxSelect.dispatchEvent(new Event("change"))}function auxMouseDown(a){a.preventDefault();a.stopImmediatePropagation();document.body.classList.add("auxPicker")}auxSelect.addEventListener("mousedown",auxMouseDown);function auxPickerClick(a){"BUTTON"==a.target.nodeName&&(auxSelect.value=a.target.value,auxSelect.dispatchEvent(new Event("change")),document.body.classList.remove("auxPicker"))}auxiliaries.addEventListener("click",auxPickerClick);var tapedTwice=!1;
function tapSlider(a){if(!tapedTwice)return tapedTwice=!0,setTimeout(function(){tapedTwice=!1},300),!1;resetSlider(a)}function resetSlider(a){a.target.value=0;a.target.dispatchEvent(new Event("input"))}
function buildChannels(a){var c="";a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,c+="<div>",c+='<label class="volume"><span>'+b.label+'</span><input type="range" data-channel="'+b.channel+'" class="volumeInput" step="0.01" min="0" max="1" value="0" /></label>',c+='<label class="pan"><span>'+b.label+'</span><input type="range" data-channel="'+b.channel+'" class="panInput" step="0.01" min="-1" max="1" value="0" /></label>',c+='<label class="favourite starCheckbox"><input type="checkbox" name="fav[]" value="'+
b.channel+'" title="Mark as Favourite" /></label>',c+="</div>";channelsDiv.innerHTML=c;c=$jscomp.makeIterator(document.querySelectorAll(".volumeInput, .panInput"));for(a=c.next();!a.done;a=c.next())a=a.value,a.addEventListener("input",sliderChange),a.addEventListener("touchstart",tapSlider),a.addEventListener("dblclick",resetSlider)}function onOpen(){document.body.classList.remove("disconnected")}
function noConnection(){ws&&ws.close();clearTimeout(timeout);timeout=setTimeout(startWebsocket,2E3);document.body.classList.add("disconnected")}function startWebsocket(){ws=new WebSocket("ws://"+document.location.host);ws.onopen=onOpen;ws.onmessage=onMessage;ws.onclose=noConnection;ws.onerror=noConnection}
document.addEventListener("DOMContentLoaded",function(){panCheckbox.checked=!1;startWebsocket();auxSelect.addEventListener("change",function(a){localStorage.setItem("aux",this.value);a=this.getElementsByTagName("option")[this.selectedIndex].dataset.colour;document.body.style.setProperty("--tint",a);this.previousElementSibling.innerHTML=this.getElementsByTagName("option")[this.selectedIndex].text;"true"==this.getElementsByTagName("option")[this.selectedIndex].dataset.stereo?panCheckbox.parentNode.style.display=
"flex":panCheckbox.parentNode.style.display="none";panCheckbox.checked=!1;panCheckbox.dispatchEvent(new Event("change"));requestValues()});panCheckbox.addEventListener("change",function(a){this.checked?document.body.classList.add("panning"):document.body.classList.remove("panning")});favourites.addEventListener("change",function(a){channelsDiv.style.overflow="hidden";channelsDiv.scrollTop=0;setTimeout(function(){channelsDiv.style.removeProperty("overflow")},10);localStorage.setItem("aux"+auxSelect.value+
"favChecked",favourites.checked);a=$jscomp.makeIterator(document.querySelectorAll('input[name="fav[]"]'));for(var c=a.next();!c.done;c=a.next())c=c.value,c.checked||!favourites.checked?c.closest("div").style.removeProperty("display"):c.closest("div").style.display="none";favourites.checked?document.body.classList.add("favourites"):document.body.classList.remove("favourites")});channelsDiv.addEventListener("change",function(a){if("fav[]"==a.target.name){a=[];for(var c=$jscomp.makeIterator(document.querySelectorAll('input[name="fav[]"]:checked')),
b=c.next();!b.done;b=c.next())a.push(b.value.value);localStorage.setItem("aux"+auxSelect.value+"fav",a.join(","))}})});

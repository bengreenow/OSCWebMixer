var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var c=0;return function(){return c<a.length?{done:!1,value:a[c++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var c="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return c?c.call(a):$jscomp.arrayIterator(a)};
var channelsDiv=document.getElementById("channels"),auxSelect=document.getElementById("aux"),panCheckbox=document.getElementById("panning"),favourites=document.getElementById("favourites"),auxiliaries=document.getElementById("auxiliaries"),ws=null,timeout=null;
function sliderChange(a){this.parentNode.style.setProperty("--value",100*this.value+"%");ws&&(a="send_level",this.classList.contains("panInput")&&(a="send_pan"),ws.send(JSON.stringify({address:"/sd/Input_Channels/"+this.dataset.channel+"/Aux_Send/"+auxSelect.value+"/"+a,args:[parseFloat(this.value)]})))}function requestValues(){ws.send(JSON.stringify({address:"/sd/Aux_Outputs/"+auxSelect.value+"/?",args:[]}))}
function onMessage(a){a=JSON.parse(a.data);if("config"==a.address)buildAux(a.args.aux),buildChannels(a.args.channels);else if(a.address=="/sd/Aux_Outputs/"+auxSelect.value){for(var c=$jscomp.makeIterator(document.getElementsByClassName("volumeInput")),b=c.next();!b.done;b=c.next()){b=b.value;var d=void 0,e=null!=(d=a.args["/sd/Input_Channels/"+b.dataset.channel+"/Aux_Send/"+auxSelect.value+"/send_level"])?d:0;b.value=e;b.parentNode.style.setProperty("--value",100*e+"%")}c=$jscomp.makeIterator(document.getElementsByClassName("panInput"));
for(b=c.next();!b.done;b=c.next())b=b.value,d=void 0,e=null!=(d=a.args["/sd/Input_Channels/"+b.dataset.channel+"/Aux_Send/"+auxSelect.value+"/send_pan"])?d:.5,b.value=e,b.parentNode.style.setProperty("--value",100*e+"%");a=(a=localStorage.getItem("aux"+auxSelect.value+"fav"))?a.split(","):[];favourites.checked="true"==localStorage.getItem("aux"+auxSelect.value+"favChecked");b=$jscomp.makeIterator(document.querySelectorAll('input[name="fav[]"]'));for(c=b.next();!c.done;c=b.next())c=c.value,c.checked=
-1!=a.indexOf(c.value);favourites.dispatchEvent(new Event("change"))}else if(b=/\/sd\/Aux_Outputs\/([0-9]+)\/Buss_Trim\/name/.exec(a.address)){b=b[1];c=$jscomp.makeIterator(auxSelect.options);for(d=c.next();!d.done;d=c.next())d=d.value,d.value==b&&(d.innerHTML=a.args[0],auxSelect.previousElementSibling.innerHTML=auxSelect.getElementsByTagName("option")[auxSelect.selectedIndex].text);c=$jscomp.makeIterator(auxiliaries.getElementsByTagName("button"));for(d=c.next();!d.done;d=c.next())d=d.value,d.value==
b&&(d.innerText=a.args[0])}else if(b=/\/sd\/Input_Channels\/([0-9]+)\/Channel_Input\/name/.exec(a.address))for(c=$jscomp.makeIterator(document.querySelectorAll('input[data-channel="'+b[1]+'"]')),b=c.next();!b.done;b=c.next())b.value.previousElementSibling.innerHTML=a.args[0];else if(b=new RegExp("/sd/Input_Channels/([0-9]+)/Aux_Send/"+auxSelect.value+"/send_level"),b=b.exec(a.address))for(c=$jscomp.makeIterator(document.querySelectorAll('input[data-channel="'+b[1]+'"].volumeInput')),b=c.next();!b.done;b=
c.next())b=b.value,b.parentNode.style.setProperty("--value",100*a.args[0]+"%"),b.value=a.args[0];else if(b=new RegExp("/sd/Input_Channels/([0-9]+)/Aux_Send/"+auxSelect.value+"/send_pan"),b=b.exec(a.address))for(c=$jscomp.makeIterator(document.querySelectorAll('input[data-channel="'+b[1]+'"].panInput')),b=c.next();!b.done;b=c.next())b=b.value,b.parentNode.style.setProperty("--value",100*a.args[0]+"%"),b.value=a.args[0]}
function buildAux(a){var c="";auxiliaries.innerHTML="";a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next()){b=b.value;c+='<option value="'+b.send+'" data-colour="'+b.colour+'" data-stereo="'+b.stereo+'">'+b.label+"</option>";var d=document.createElement("button");d.value=b.send;d.innerHTML=b.label;d.style.setProperty("--tint",b.colour);auxiliaries.appendChild(d)}auxSelect.innerHTML=c;localStorage.getItem("aux")?auxSelect.value=localStorage.getItem("aux"):document.body.classList.add("auxPicker");
auxSelect.dispatchEvent(new Event("change"))}function auxMouseDown(a){a.preventDefault();a.stopImmediatePropagation();document.body.classList.add("auxPicker")}auxSelect.addEventListener("mousedown",auxMouseDown);function auxPickerClick(a){"BUTTON"==a.target.nodeName&&(auxSelect.value=a.target.value,auxSelect.dispatchEvent(new Event("change")),document.body.classList.remove("auxPicker"))}auxiliaries.addEventListener("click",auxPickerClick);var tapedTwice=!1;
function tapSlider(a){if(!tapedTwice)return tapedTwice=!0,setTimeout(function(){tapedTwice=!1},300),!1;resetSlider(a)}function resetSlider(a){a.target.classList.contains("panInput")&&(a.target.value=.5);a.target.classList.contains("volumeInput")&&(a.target.value=0);a.target.dispatchEvent(new Event("input"))}
function buildChannels(a){var c="";a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,c+="<div>",c+='<label class="volume"><span>'+b.label+'</span><input type="range" data-channel="'+b.number+'" class="volumeInput" step="0.01" min="0" max="1" value="0" /></label>',c+='<label class="pan"><span>'+b.label+'</span><input type="range" data-channel="'+b.number+'" class="panInput" step="0.01" min="0" max="1" value="0.5" /></label>',c+='<label class="favourite starCheckbox"><input type="checkbox" name="fav[]" value="'+
b.number+'" title="Mark as Favourite" /></label>',c+="</div>";channelsDiv.innerHTML=c;c=$jscomp.makeIterator(document.querySelectorAll(".volumeInput, .panInput"));for(a=c.next();!a.done;a=c.next())a=a.value,a.addEventListener("input",sliderChange),a.addEventListener("touchstart",tapSlider),a.addEventListener("dblclick",resetSlider)}function onOpen(){document.body.classList.remove("disconnected")}
function noConnection(){ws&&ws.close();clearTimeout(timeout);timeout=setTimeout(startWebsocket,2E3);document.body.classList.add("disconnected")}function startWebsocket(){ws=new WebSocket("ws://"+document.location.host);ws.onopen=onOpen;ws.onmessage=onMessage;ws.onclose=noConnection;ws.onerror=noConnection}
document.addEventListener("DOMContentLoaded",function(){panCheckbox.checked=!1;startWebsocket();auxSelect.addEventListener("change",function(a){localStorage.setItem("aux",this.value);a=this.getElementsByTagName("option")[this.selectedIndex].dataset.colour;document.body.style.setProperty("--tint",a);this.previousElementSibling.innerHTML=this.getElementsByTagName("option")[this.selectedIndex].text;"true"==this.getElementsByTagName("option")[this.selectedIndex].dataset.stereo?panCheckbox.parentNode.style.display=
"flex":panCheckbox.parentNode.style.display="none";panCheckbox.checked=!1;panCheckbox.dispatchEvent(new Event("change"));requestValues()});panCheckbox.addEventListener("change",function(a){this.checked?document.body.classList.add("panning"):document.body.classList.remove("panning")});window.onresize=function(){"standalone"in navigator&&navigator.standalone||document.body.style.setProperty("--vh",window.innerHeight+"px")};window.onresize();favourites.addEventListener("change",function(a){channelsDiv.style.overflow=
"hidden";channelsDiv.scrollTop=0;setTimeout(function(){channelsDiv.style.removeProperty("overflow")},10);localStorage.setItem("aux"+auxSelect.value+"favChecked",favourites.checked);a=$jscomp.makeIterator(document.querySelectorAll('input[name="fav[]"]'));for(var c=a.next();!c.done;c=a.next())c=c.value,c.checked||!favourites.checked?c.closest("div").style.removeProperty("display"):c.closest("div").style.display="none";favourites.checked?document.body.classList.add("favourites"):document.body.classList.remove("favourites")});
channelsDiv.addEventListener("change",function(a){if("fav[]"==a.target.name){a=[];for(var c=$jscomp.makeIterator(document.querySelectorAll('input[name="fav[]"]:checked')),b=c.next();!b.done;b=c.next())a.push(b.value.value);localStorage.setItem("aux"+auxSelect.value+"fav",a.join(","))}})});
